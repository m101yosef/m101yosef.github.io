{{/* Table of Contents */}}

{{- $toc := .Params.toc | default true -}}

{{/* UI Text */}}
{{- $on_this_page := T "on_this_page" }}

<nav class="hb-toc order-last hidden w-64 shrink-0 xl:block print:hidden px-4" aria-label="table of contents">
  {{- if $toc }}
  <div class="hb-scrollbar text-sm [hyphens:auto] sticky top-16 overflow-y-auto pr-4 pt-6 max-h-[calc(100vh-var(--navbar-height)-env(safe-area-inset-bottom))] -mr-4 rtl:-ml-4">
    {{- with .Fragments.Headings -}}
    <p class="mb-4 font-semibold tracking-tight">{{ $on_this_page }}</p>
    {{- range . -}}
    <ul class="flex flex-col">
      {{- with .Headings -}}{{ template "toc-headings" . }}{{- end -}}
    </ul>
    {{- end -}}
    {{- end -}}

    {{/* You can keep your page features section as is */}}
    {{- $class := "" -}}
    {{- if .Fragments.Headings -}}
      {{- $class = "mt-8 border-t dark:border-neutral-700 pt-8" -}}
    {{- end -}}
    {{ partial "functions/get_hook" (dict "hook" "toc-end" "context" .) }}

  </div>
  {{ end -}}
</nav>

{{/* Render Headings -- MODIFIED SECTION */}}
{{- define "toc-headings" -}}
  {{- range . }}
    {{- if .Title }}
      {{- $has_children := .Headings -}}
      <li class="my-1 scroll-my-6 scroll-py-6">
        <div class="flex items-center justify-between">
          <a class="inline-block font-thin text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 w-full break-words" href="#{{ anchorize .ID }}">
            {{- .Title | plainify | htmlUnescape -}}
          </a>
          {{- if $has_children }}
            <button data-hb-toc-toggle class="flex text-gray-500 dark:text-gray-400" aria-label="Toggle section">
                <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-[18px] min-w-[18px] rounded-sm p-0.5 transition-transform rtl:-rotate-180"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="origin-center"></path></svg>
            </button>
          {{- end }}
        </div>
      </li>
      {{- if $has_children -}}
        <ul class="pl-4 rtl:pr-4 border-l rtl:border-r border-gray-200 dark:border-neutral-700">
          {{ template "toc-headings" .Headings }}
        </ul>
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- end -}}